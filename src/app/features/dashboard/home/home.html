<div class="dash">
  <div class="head">
    <div>
      <h2>Dashboard</h2>
      <p class="hint">Quick overview of your DumpSpace®</p>
    </div>

    <div class="actions">
      <a class="action-upload" routerLink="/home/upload">
        <mat-icon>upload</mat-icon>
        Upload
      </a>
      <a class="action-media" routerLink="/home/images">
        <mat-icon>image</mat-icon>
        Images
      </a>
      <a class="action-media" routerLink="/home/videos">
        <mat-icon>movie</mat-icon>
        Videos
      </a>
    </div>
  </div>

  <!-- Stats -->
  <ng-container *ngIf="stats$ | async as s">
    <div class="stats">
      <div class="stat">
        <div class="m">Files</div>
        <div class="tm">{{ s.totalFiles }}</div>
      </div>
      <div class="stat">
        <div class="m">Images</div>
        <div class="tm">{{ s.totalImages }}</div>
      </div>
      <div class="stat">
        <div class="m">Videos</div>
        <div class="tm">{{ s.totalVideos }}</div>
      </div>
      <div class="stat">
        <div class="m">Storage used</div>
        <div class="tm">{{ formatBytes(s.totalBytes) }}</div>
      </div>
    </div>
  </ng-container>

  <!-- Recent -->
  <div class="section">
    <div class="sectionHead">
      <h3>Recent uploads</h3>
      <a class="link" routerLink="/home/images">View all</a>
    </div>

    <ng-container *ngIf="recent$ | async as items">
      <div class="empty" *ngIf="!items.length">
        No uploads yet. Hit <strong>Upload</strong> to dump some media files!
      </div>

      <div class="grid" *ngIf="items.length">
        <div class="card" *ngFor="let m of items">
          <div class="thumb" (click)="openPreview(m, $event)">
            <img *ngIf="(m.contentType || '').startsWith('image/')" [src]="m.downloadUrl" [alt]="m.name" />
            <div class="videoThumb" *ngIf="(m.contentType || '').startsWith('video/')">
              <video [src]="m.downloadUrl" muted playsinline preload="metadata"></video>
              <div class="play">▶</div>
            </div>
          </div>

          <div class="meta">
            <div class="name" [title]="m.originalName || m.name">{{ m.originalName || m.name }}</div>

            <div class="row">
              <div class="sub">
                <span>{{ formatBytes(m.size) }}</span>
                <span class="dot">•</span>
                <span>{{ m.status || 'READY' }}</span>
              </div>

              <div class="btns" (click)="$event.stopPropagation()">
                <button mat-icon-button class="iconBtn" aria-label="Download" (click)="download(m, $event)">
                  <mat-icon>download</mat-icon>
                </button>
                <button mat-icon-button class="iconBtn danger" aria-label="Delete" (click)="delete(m, $event)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Preview Modal -->
  <div class="backdrop" *ngIf="previewUrl" (click)="closePreview()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modalTop">
        <div class="modalTitle">{{ previewName }}</div>
        <button mat-icon-button aria-label="Close" (click)="closePreview()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <img *ngIf="!previewIsVideo" class="modalMedia" [src]="previewUrl!" [alt]="previewName" />
      <video *ngIf="previewIsVideo" class="modalMedia" [src]="previewUrl!" controls playsinline></video>
    </div>
  </div>
</div>